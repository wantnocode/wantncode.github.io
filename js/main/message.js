window.addEventListener("message",function(d){var b=JSON.parse(JSON.stringify(d.data));1==b.type&&(pattern=b.pattern,0==b.header_state&&$(".graph_pro").hide(),entity_type=b.entity_type,graph_id=b.graph_id,model=b.model,b.nodeArray.forEach(function(a){a.d_stroke=a.stroke;a.d_fill=a.fill;a.default_stroke=a.d_stroke;a.default_fill=a.d_fill}),graph_mode=b.graph_mode,b.linkArray.forEach(function(a){a.source=a.from;a.target=a.to;a.d_stroke=a.stroke;"basic"!==graph_mode&&(a.dir=1)}),init_rightMenu_list(),
nodeArray=b.nodeArray,linkArray=b.linkArray,original_nodes=b.original_nodes,original_links=b.original_links,layout=b.layout,entity_list=b.entity_list,entity_tags=b.entity_tags,moneys=b.moneys,schema=b.schema?b.schema:0,setLayout(layout));2==b.type&&graph_methods(b);if(3==b.type){if(1==b.order){layout=b.layout;if("ForceDirectedLayout"!==layout&&1E4<nodeArray.length&&1E4<linkArray.length){$(".entity_toast").css("left",document.body.clientWidth/2-200);$(".entity_toast").css("top",300);$(".entity_toast").text("\u5f53\u524d\u8282\u70b9\u4e0e\u8fb9\u6570\u91cf\u8d85\u8fc72\u4e07,\u4e0d\u652f\u6301\u4f7f\u7528"+
layout+"\u5e03\u5c40\u4ea4\u4e92,\u8bf7\u9009\u62e9\u5176\u5b83\u5e03\u5c40");$(".entity_toast").show();setTimeout(function(){$(".entity_toast").hide()},3E3);return}$(".loading").show();$(".loading_box").show();setTimeout(function(){setLayout(b.layout)},0)}2==b.order&&search_entity(b.search_text);3==b.order&&graph_tool.undo();4==b.order&&graph_tool.redo();5==b.order&&setLabel_state(b.labelisShow);6==b.order&&(entity_type=b.entity_type,graph_id=b.graph_id,model=b.model);7==b.order&&merge_link_method(b);
8==b.order&&cancel_mergeLink(b);9==b.order&&merge_vertex();10==b.order&&cacel_merge_node();if(11==b.order){if(2===rendering_type){webgl_selectAll();return}graph_tool.selectAll()}if(12==b.order){if(2===rendering_type){webgl_reverseSelected();return}graph_tool.reverseSelected()}if(13==b.order){var f=graph_tool.getcurrentNodes();f.map(function(a){myDiagram.model.setDataProperty(a,"visible",!1)})}14==b.order&&(myDiagram.model.nodeDataArray.map(function(a){myDiagram.model.setDataProperty(a,"visible",!0)}),
myDiagram.model.linkDataArray.map(function(a){myDiagram.model.setDataProperty(a,"visible",!0)}));if(15==b.order){var l=graph_tool.getcurrentNodes();myDiagram.nodes.each(function(a){l.map(function(c){a.key==c.key&&lockings.push({key:a.key,loc:a.location})})})}16==b.order&&(lockings=[]);17==b.order&&myDiagram.commandHandler.resetZoom();if(18==b.order){if(2==rendering_type){webgl_zoomToFit();return}myDiagram.commandHandler.zoomToFit()}19==b.order&&(2==rendering_type&&webgl_scrollToPart(),myDiagram.scale=
2,myDiagram.commandHandler.scrollToPart(graph_tool.getcurrentNode()[0]));20==b.order&&("start"==b.start_or_stop&&start_layout_animation(),"stop"==b.start_or_stop&&stop_layout_animation());22==b.order&&(webgl_graph_state="tz",change_selectordrag(!1));23==b.order&&(webgl_graph_state="xz",change_selectordrag(!0));24==b.order&&select_Both_ends();25==b.order&&select_links();26==b.order&&select_Both_ends_links();27==b.order&&setEntity2hide();28==b.order&&graph_tool.increaseZoom();29==b.order&&graph_tool.decreaseZoom();
29==b.order&&graph_tool.decreaseZoom();29==b.order&&graph_tool.decreaseZoom();30==b.order&&_findAllPath();31==b.order&&_findShortPath()}if(4==b.type){1==b.get_type&&(downloadImgName=b.downloadImgName,2==rendering_type&&webgl_downloadImg(),graph_tool.makeBlob());if(3==b.get_type){if(2==rendering_type){webgl_getGraphAssets();return}graph_tool.makeBlob_toParent()}4==b.get_type&&(d={vertexs:graph_tool.getcurrentNodes(),startVertex:startVertex,endVertex:endVertex,g_json:graph_tool.graphtoJson(),entity_list:entity_list,
msg:"\u83b7\u53d6\u9009\u4e2d\u8282\u70b9\u96c6\u5408"},postmessageToParent(d));5==b.get_type&&(d={edges:graph_tool.getcurrentEdges(),msg:"\u83b7\u53d6\u9009\u4e2d\u8fb9\u96c6\u5408"},postmessageToParent(d));6==b.get_type&&(d=graph_methods.getGraphAssets(2),postmessageToParent(d));7==b.get_type&&(d={g_json:graph_tool.graphtoJson(),vertexs:graph_tool.getcurrentNodes(),original_nodes:original_nodes,original_links:original_links},postmessageToParent(d));8==b.get_type&&(d={msg:"\u83b7\u53d6\u8fb9\u6240\u6709\u7c7b\u578b\u548c\u5c5e\u6027",
data:get_graph_links_type()},postmessageToParent(d));9==b.get_type&&(d={msg:"\u83b7\u53d6\u5f53\u524d\u5408\u5e76\u7684\u8fb9\u7c7b\u578b",data:get_graph_mergeLink_type()},postmessageToParent(d));10==b.get_type&&(console.log(myDiagram.model.nodeDataArray),d={msg:"\u83b7\u53d6\u7ef4\u5ea6\u4fe1\u606f",node_rows:get_node_rows(),link_rows:get_link_rows(),link_Dimension_count:get_link_Dimension_count(),node_Dimension_count:get_node_Dimension_count()},postmessageToParent(d));$(".item-inner").hide()}if(5==
b.type){b.nodeArray.forEach(function(a){a.d_stroke=a.stroke;a.d_fill=a.fill;a.default_stroke=a.d_stroke;a.default_fill=a.d_fill});f=b.nodeArray;var h=b.linkArray;f.map(function(a,c){var e=0;myDiagram.model.nodeDataArray.map(function(m){m.key==a.key&&e++});a.key!==graph_tool.getcurrentNodes().key&&0==e&&myDiagram.model.addNodeData(a)});h.map(function(a){var c=0;myDiagram.model.linkDataArray.map(function(e){e.from==a.from&&e.to==a.to&&c++});0==c&&myDiagram.model.addLinkData(a)});nodeArray=myDiagram.model.nodeDataArray;
linkArray=myDiagram.model.linkDataArray;"ForceDirectedLayout"==layout&&setLayout("ForceDirectedLayout")}6==b.type&&(f=b.nodeArray,h=b.linkArray,myDiagram.model.nodeDataArray.map(function(a){f.map(function(c){a.key==c.key&&(myDiagram.model.setDataProperty(a,"fill","#EE0000"),myDiagram.model.setDataProperty(a,"stroke","#EE0000"),myDiagram.model.setDataProperty(a,"highlight_fill","#EE0000"),myDiagram.model.setDataProperty(a,"highlight_stroke","#EE0000"))})}),myDiagram.model.linkDataArray.map(function(a){h.map(function(c){a.e_ids==
c.e_ids&&(myDiagram.model.setDataProperty(a,"fill","#EE0000"),myDiagram.model.setDataProperty(a,"stroke","#EE0000"),myDiagram.model.setDataProperty(a,"highlight_fill","#EE0000"),myDiagram.model.setDataProperty(a,"highlight_stroke","#EE0000"))})}));if(7==b.type){var k=b.newData;myDiagram.model.nodeDataArray.map(function(a){a.key==k.key&&myDiagram.model.setDataProperty(a,"tags",k.tags)})}if(8==b.type)myDiagram.startTransaction("CollapseExpandTree"),nodeArray=b.nodeArray,linkArray=b.linkArray,nodeArray.map(function(a){var c=
0;myDiagram.model.nodeDataArray.map(function(e){e.key==a.key&&c++});a.key!==graph_tool.getcurrentNode().key&&0==c&&(a.parent=graph_tool.getcurrentNode().key,myDiagram.model.addNodeData(a))}),linkArray.map(function(a){var c=0;myDiagram.model.linkDataArray.map(function(e){e.from==a.from&&e.to==a.to&&e.e_ids==a.e_ids&&c++});0==c&&myDiagram.model.addLinkData(a)}),myDiagram.commitTransaction("CollapseExpandTree"),nodeArray=myDiagram.model.nodeDataArray,linkArray=myDiagram.model.linkDataArray;else{if(9==
b.type){0==original_nodes.length&&0==original_links.length&&(myDiagram.model.nodeDataArray.map(function(a){original_nodes.push(a)}),myDiagram.model.linkDataArray.map(function(a){original_links.push(a)}));if(1==b.state){if(0<b.nodeArray.length){var g=[];nodeArray.map(function(a,c){b.nodeArray[0].type!==a.type&&g.push(a)});nodeArray=g.concat(b.nodeArray)}nodeArray.forEach(function(a){a.d_stroke=a.stroke;a.d_fill=a.fill;a.default_stroke=a.d_stroke;a.default_fill=a.d_fill})}2==b.state&&(g=[],0<b.linkArray.length&&
(linkArray.map(function(a,c){b.linkArray[0].type!==a.type&&g.push(a)}),linkArray=g.concat(b.linkArray),linkArray.forEach(function(a){a.d_stroke=a.stroke;a.d_fill=a.fill;a.default_stroke=a.d_stroke;a.default_fill=a.d_fill})));setLayout(layout)}10==b.type&&(0<original_nodes.length||0<original_links.length?(nodeArray=original_nodes,linkArray=original_links,original_nodes=[],original_links=[],setLayout(layout)):console.log("\u672a\u683c\u5f0f\u5316"));11==b.type&&(b.node&&(myDiagram.model.addNodeData(b.node),
myDiagram.nodes.each(function(a){a.data.key==b.node&&myDiagram.commandHandler.scrollToPart(a.data)})),b.link&&myDiagram.model.addLinkData(b.link));12==b.type&&b.nodes&&b.nodes.map(function(a){myDiagram.nodes.each(function(c){f.data.id==a.id&&(c.isSelected=!0)})});13==b.type&&(1<=b.nodeArray.length&&b.nodeArray.map(function(a){myDiagram.model.nodeDataArray.map(function(c){a.id==c.id&&(myDiagram.model.setDataProperty(c,"d_stroke",a.stroke),myDiagram.model.setDataProperty(c,"default_stroke",a.stroke),
myDiagram.model.setDataProperty(c,"d_fill",a.fill),myDiagram.model.setDataProperty(c,"default_fill",a.fill),myDiagram.model.setDataProperty(c,"width",a.width),myDiagram.model.setDataProperty(c,"height",a.height),myDiagram.model.setDataProperty(c,"icon",a.icon),myDiagram.model.setDataProperty(c,"color",a.color))})}),1<=b.linkArray.length&&b.linkArray.map(function(a){myDiagram.model.linkDataArray.map(function(c){a.id==c.id&&(myDiagram.model.setDataProperty(c,"d_stroke",a.stroke),myDiagram.model.setDataProperty(c,
"default_stroke",a.stroke),myDiagram.model.setDataProperty(c,"patt",a.patt),myDiagram.model.setDataProperty(c,"width",a.width))})}))}});function postmessageToParent(d){window.parent.postMessage(d,"*")};